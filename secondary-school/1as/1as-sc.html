<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حساب المعدل الفصلي</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Replace jsPDF library and its dependencies with html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Add custom font support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <CENTER>
        <div id="ykth"><div class="ykth-inner">
<div class='ykth-head'>
<svg style="width:30px;height:30px" viewBox="0 0 26 26"><path fill="#FFFFFF" d="M13,13H11V7H13M12,17.3A1.3,1.3 0 0,1 10.7,16A1.3,1.3 0 0,1 12,14.7A1.3,1.3 0 0,1 13.3,16A1.3,1.3 0 0,1 12,17.3M15.73,3H8.27L3,8.27V15.73L8.27,21H15.73L21,15.73V8.27L15.73,3Z"/></svg>
<b>Adblock Detect</b>
<p>We have detected that you are using adblock in your browser</p>
<i class="close" onclick="document.getElementById(ykrd1).style.display=&quot;none&quot;">&#215</i>
</div>
<div class='ykth-body'>
<p>Our website is made possible by displaying online advertisements to our visitors.</p>
<p>Please consider supporting us by disabling your ad blocker.</p>
</div>
<!-- Start Condition When JS Disable -->
<noscript>
<div class="ykth-body">
	<p>Javascript is disabled in your web browser.</p>
	<p>For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="https://www.enable-javascript.com/" target="_blank"> instructions how to enable JavaScript in your web browser</a>.</p>
</div>
<style>#ykth{display:block;}.ykth-inner>.ykth-body{display:none;}.ykth-head>b,.ykth-head>p{font-size:0}.ykth-head>b:before{content:"Javascript Detected";font-size:16px}.ykth-head>p:before{content:"We have detected that you are disable javascript in your browser";font-size:14px}</style>
</noscript>
<!-- End Condition When JS Disable -->
</div></div>
<script type="text/javascript" src="https://cdn.rawgit.com/Yuukithemes/yuukithemes.github.io/92c11f42/js/advertisement.js"></script>
    </CENTER>
</head>
<body>
    <div class="container">
        <div class="center">
            <div class="center">
            <script type="text/javascript">
                atOptions = {
                    'key' : '76373a8ee469bdc7e18a98b28a1916e7',
                    'format' : 'iframe',
                    'height' : 60,
                    'width' : 400,
                    'params' : {}
                };
            </script>
            <script></script><iframe allowtransparency="true" scrolling="no" frameborder="0" framespacing="0" width="468" height="60" src="about:blank"></iframe><script type="text/javascript" src="//www.highperformanceformat.com/76373a8ee469bdc7e18a98b28a1916e7/invoke.js" class="atScript76373a8ee469bdc7e18a98b28a1916e7_0"></script>
                </div>
        </div>
        <h1>حساب المعدل الفصلي</h1>
        <h2>سنة اولى ثانوي</h2>
        <h3>جدع مشترك علوم و تكنولوجيا</h3>
        
        <table>
            <thead>
                <tr>
                    <th>المادة</th>
                    <th>الفرض</th>
                    <th>التقويم</th>
                    <th>الاختبار</th>
                    <th>المعامل</th>
                    <th>معدل المادة</th>
                </tr>
            </thead>
            <tbody id="gradesTable">
                <!-- سيتم ملء الجدول ديناميكيا -->
            </tbody>
        </table>

        <div class="button-group">
            <button onclick="calculateAverage()">حساب المعدل الفصلي</button>
            <button onclick="exportToPDF()">تحميل PDF</button>
        </div>
        
        <h2 id="finalAverage">المعدل الفصلي: --</h2>

        <footer>
            <p>Mohamed Nassereddine Hamouda</p>
            <p>All rights saved - 2025</p>
        </footer>
    </div>

    <script>
        // أسماء المواد مع المعاملات المحددة مسبقًا
        const subjects = [

        { name: "رياضيات", coefficient: 5 },
    { name: "فيزياء", coefficient: 4 },
    { name: "علوم طبيعية", coefficient: 4},
    { name: "اعلام الي", coefficient: 2 },
    { name: "عربية", coefficient: 3 },
    { name: "فرنسية", coefficient: 2 },
    { name: "إنجليزية", coefficient: 2 },
    { name: "اجتماعيات", coefficient: 2 },
    { name: "تكنولوجيا", coefficient: 2 },
    { name: "تربية إسلامية", coefficient: 2 },
    { name: "تربية بدنية", coefficient: 1 }
];
// إنشاء الجدول تلقائيًا
const tableBody = document.getElementById("gradesTable");

// تحميل العلامات المحفوظة إن وجدت
let savedData = JSON.parse(localStorage.getItem("gradesData")) || {};

subjects.forEach(subject => {
    let row = document.createElement("tr");
    row.innerHTML = `
        <td>${subject.name}</td>
        <td><input type="number" min="0" max="20" step="0.01" class="grade" data-subject="${subject.name}" data-type="assignment"></td>
        <td><input type="number" min="0" max="20" step="0.01" class="grade" data-subject="${subject.name}" data-type="assessment"></td>
        <td><input type="number" min="0" max="20" step="0.01" class="grade" data-subject="${subject.name}" data-type="test"></td>
        <td>${subject.coefficient}</td>
        <td class="subjectAverage">--</td>
    `;
    tableBody.appendChild(row);

    // تحميل العلامات المحفوظة إن وجدت
    if (savedData[subject.name]) {
        let inputs = row.querySelectorAll(".grade");
        inputs[0].value = savedData[subject.name].assignment;
        inputs[1].value = savedData[subject.name].assessment;
        inputs[2].value = savedData[subject.name].test;
    }
});

// حفظ العلامات عند الإدخال وتطبيق القيود
document.querySelectorAll(".grade").forEach(input => {
    input.addEventListener("input", function() {
        let value = parseFloat(this.value);
        if (value > 20) {
            this.value = 20;
        } else if (value < 0) {
            this.value = 0;
        }
        saveGrades();
    });
});

function saveGrades() {
    let data = {};

    document.querySelectorAll("#gradesTable tr").forEach(row => {
        let subject = row.cells[0].innerText;
        let grades = row.querySelectorAll(".grade");

        data[subject] = {
            assignment: grades[0].value || "",
            assessment: grades[1].value || "",
            test: grades[2].value || ""
        };
    });

    localStorage.setItem("gradesData", JSON.stringify(data));
}

// حساب المعدل الفصلي
function calculateAverage() {
    let totalWeightedSum = 0;
    let totalCoefficient = 0;

    document.querySelectorAll("#gradesTable tr").forEach(row => {
        let grades = row.querySelectorAll(".grade");
        let coefficient = parseFloat(row.cells[4].innerText);

        let test = parseFloat(grades[2].value) || 0;
        let assessment = parseFloat(grades[1].value) || 0;
        let assignment = parseFloat(grades[0].value) || 0;

        let subjectAverage = ((assignment + assessment + 2 * test) / 4) * coefficient;
        row.querySelector(".subjectAverage").innerText = subjectAverage.toFixed(2);

        totalWeightedSum += subjectAverage;
        totalCoefficient += coefficient;
    });

    let finalAverage = totalCoefficient > 0 ? (totalWeightedSum / totalCoefficient).toFixed(2) : "--";
    document.getElementById("finalAverage").innerText = "المعدل الفصلي: " + finalAverage;

    saveGrades(); // حفظ العلامات بعد الحساب
}

// إضافة وظيفة تصدير PDF
function exportToPDF() {
    // Create a clone of the container to modify for PDF
    const container = document.querySelector('.container').cloneNode(true);
    
    // Add some styling for PDF
    const style = document.createElement('style');
    style.textContent = `
        .container { padding: 20px; direction: rtl; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; page-break-inside: avoid; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
        th { background-color: #3498db; color: white; }
        h1, h2, h3 { margin: 10px 0; }
        .button-group { display: none; }
        footer { margin-top: 20px; }
    `;
    container.prepend(style);

    // Configure PDF options
    const opt = {
        margin: [10, 10, 10, 10],
        filename: 'كشف_العلامات.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            logging: false,
            dpi: 192,
            letterRendering: true,
            scrollY: 0,
            windowWidth: document.documentElement.scrollWidth
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait',
            compress: true
        },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
    };

    // Generate PDF
    html2pdf().from(container).set(opt).save()
        .catch(err => {
            console.error('Error generating PDF:', err);
            alert('حدث خطأ أثناء إنشاء ملف PDF. يرجى المحاولة مرة أخرى.');
        });
}

// تحميل البيانات تلقائيًا عند فتح الصفحة
document.addEventListener("DOMContentLoaded", () => {
    saveGrades();
    calculateAverage(); // حساب المعدل مباشرة عند تحميل البيانات المحفوظة
});
    </script>
</body>
</html>
